(this["webpackJsonpvangso-misssion-control"]=this["webpackJsonpvangso-misssion-control"]||[]).push([[0],{0:function(e,t){e.exports=Cesium},22:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(9),c=n.n(i),s=(n(22),n(0)),o=n(5),l=n(3),u=n(7),d=n(4),h=n(11),f=n(12),v=n(13);function j(e){var t={call:"",receiver:"",id:"",source:0,symbol:0,lat:0,lon:0,altitude:0,heading:0,speed:0,climbrate:0,rotation:0,signal:0,errors:0,timestamp:0},n=e.match(/([^>]+)/);null!=n&&(t.call=n[1]);var a=e.match(/(?:,)([a-zA-Z0-9]+)(?::\/)/);null!=a&&(t.receiver=a[1]);var r=e.match(/(?: id)([a-fA-f0-9]+)/);null!=r&&(t.id=r[1]);var i=e.match(/(?:\/)(\d+)(?:h)/);null!=i&&(t.timestamp=v.DateTime.fromFormat(i[1],"HHmmss").toMillis());var c="0",s="0",o=e.match(/(?: !W)(\d)(\d)(?:!)/);null!=o&&(c=o[1],s=o[2]);var l=e.match(/(?:h)(\d+\.\d+)(?:[NS])/);null!=l&&(t.lat=b(l[1]+c)),function(e){var t=e.match(/(?::\/\d+[h]\d+[.]\d+)(.)/);if(null==t)return null;return"N"===t[1]}(e)||(t.lat*=-1);var u=e.match(/(?:[NS].)(\d+\.\d+)(?:[EW])/);null!=u&&(t.lon=b(u[1]+s)),function(e){var t=e.match(/(?::\/\d+[h]\d+[.]\d+[NS].\d+[.]\d+)(.)/);if(null==t)return null;return"E"===t[1]}(e)||(t.lon*=-1);var d=e.match(/(?:\/A=)(\d+)/);null!=d&&(t.altitude=parseInt(d[1]));var h=e.match(/(\d+)(?:\/)(\d+)(?:\/)/);null!=h&&(t.heading=parseInt(h[1]),t.speed=parseInt(h[2]));var f=e.match(/(?: )([+-]\d+)(?:fpm)/);null!=f&&(t.climbrate=parseInt(f[1]));var j=e.match(/(?: )([+-]\d+\.\d+)(?:rot)/);null!=j&&(t.rotation=parseFloat(j[1]));var m=e.match(/(?: )(\d+\.\d+)(?:dB)/);null!=m&&(t.signal=parseFloat(m[1]));var O=e.match(/(?: )(\d+)(?:e)/);return null!=O&&(t.errors=parseInt(O[1])),t.symbol=function(e){var t=parseInt(e.substr(0,2),16);return t=t>>2&15}(t.id),t.source=function(e){var t=parseInt(e.substr(0,2),16);return t&=3}(t.id),(isNaN(t.timestamp)||isNaN(t.lon)||isNaN(t.lat)||isNaN(t.altitude)||isNaN(t.heading)||isNaN(t.speed)||isNaN(t.climbrate)||isNaN(t.rotation))&&(console.log(t),console.log(e),console.log("-----------------------")),t}function b(e){var t=Math.floor(parseInt(e)/100);return t+(parseFloat(e)-100*t)/60}var m=function(){function e(t){Object(h.a)(this,e),this.onClose=void 0,this.onTrack=void 0,this.onReport=void 0,this.onCall=void 0,this.ws=void 0,this.options=void 0,this.listeners={},this.queryCalls=[],this.options=t}return Object(f.a)(e,[{key:"connect",value:function(){var e=this;return this.ws=new this.options.WebSocket("ws://glidertracker.de:3389/"),this.ws.onclose=function(){e.ws=null,e.onClose&&e.onClose()},this.ws.onmessage=function(t){e.handleMessage(t.data)},new Promise((function(t){e.ws.onopen=t}))}},{key:"send",value:function(e){this.ws&&this.ws.send(e)}},{key:"sendQueue",value:function(){var e=this;if(this.queryCalls.length>0){var t=this.queryCalls.shift();this.send(t),setTimeout((function(){e.sendQueue()}),333)}}},{key:"disconnect",value:function(){this.ws&&(this.ws.close(),this.ws=null)}},{key:"setView",value:function(e){var t=Object(l.a)(e,4),n=t[0],a=t[1],r=t[2],i=t[3];this.send("VIEW:".concat(n,"|").concat(a,"|").concat(r,"|").concat(i))}},{key:"getOverview",value:function(e){var t=Object(l.a)(e,4),n=t[0],a=t[1],r=t[2],i=t[3];this.send("OVERVIEW?0".concat(n,"|").concat(a,"|").concat(r,"|").concat(i))}},{key:"requestTrack",value:function(e,t,n){this.send("TRACK?".concat(e,"|").concat(Math.round(t/1e3),"|").concat(Math.round(n/1e3)))}},{key:"addListenerForId",value:function(e,t){var n=this;return this.listeners[e]=t,function(){delete n.listeners[e]}}},{key:"lookupGlider",value:function(e,t){this.send("CALL?"+e+"/"+t+"|")}},{key:"handleMessage",value:function(e){if(function(e){return-1!==e.search("TRACK:")}(e)&&this.onTrack){var t=e.split("|"),n=t.shift().slice(6),a=t.filter(Boolean).map((function(e){var t=e.split("/");return{lat:parseFloat(t[0]),lon:parseFloat(t[1]),alt:parseFloat(t[2]),time:Date.parse(t[3])}}));this.onTrack(n,a)}else if(function(e){return(-1!==e.search(">OGFLR,qAS")||-1!==e.search(">APRS,qAS")||-1!==e.search(">APRS,RELAY*")||-1!==e.search(">OGNFNT,qAS")||-1!==e.search(">OGNTRK,qAS"))&&-1!==e.search(" id")}(e)){var r=j(e);this.listeners[r.id]&&this.listeners[r.id](r),this.onReport&&this.onReport(r)}else if(function(e){return-1!==e.search("CALL:")}(e)){var i=function(e){var t={id:"",call:"",cn:"",type:""},n=e.match(/(?:CALL:)([^/]+)(?:\/)([^[]+)(?:\[)([^\]]*)(?:\])([^|]*)/);return null!=n&&(t.id=n[1],t.call=n[2],t.cn=n[3],t.type=n[4]),t}(e);this.onCall&&this.onCall(i)}else(function(e){return-1!==e.search("SEEN:")})(e)||function(e){return-1!==e.search("PING?!?")}(e)&&this.send("PONG!?!")}}]),e}(),O=n(2),p=new m({WebSocket:WebSocket}),g=Object(a.createContext)(void 0);function x(){p.connect().then((function(){p.setView([14.898834,59.130863,17.512207,59.834465]),console.log("Connection established.")}))}function C(e){var t=e.children,n=Object(a.useState)((function(){try{var e=localStorage.getItem("aircraft");return e?JSON.parse(e):{}}catch(t){return{}}})),r=Object(l.a)(n,2),i=r[0],c=r[1],s=function(e,t){c(Object(d.a)(Object(d.a)({},i),{},Object(u.a)({},e,Object(d.a)(Object(d.a)({},i[e]),t))))};return p.onReport=function(e){i[e.id]?s(e.id,e):(console.info("Missing data for aircraft with id:"+e.id+". Sending lookup!"),p.lookupGlider(e.id,e.call))},p.onCall=function(e){var t=e.id,n=e.call,a=e.cn,r=e.type;s(t,e),localStorage.setItem("aircraft",JSON.stringify(Object(d.a)(Object(d.a)({},JSON.parse(localStorage.getItem("aircraft")||"{}")),{},Object(u.a)({},t,{id:t,call:n,cn:a,type:r}))))},Object(O.jsx)(g.Provider,{value:{setAircraftWithId:s,aircraft:i,client:p},children:t})}function N(){return Object(a.useContext)(g)}x(),p.onClose=function(){console.log("Connection closed. Trying again!"),x()};var y=n(16),w=n(14),S=n(15);function k(e){var t=e.data,n=[t.lon,t.lat,t.altitude,t.heading],a=n[0],r=n[1],i=n[2],c=n[3];if("number"!==typeof a)return null;var l=s.Cartesian3.fromDegrees(a,r,i+20),u=s.Math.toRadians(c-90),d=new s.HeadingPitchRoll(u,0,0),h=new s.ConstantProperty(s.Transforms.headingPitchRollQuaternion(s.Cartesian3.fromDegrees(a,r,i),d));return Object(O.jsx)(o.c,{model:{uri:"assets/arcus.glb",scale:1,maximumScale:110,minimumPixelSize:300},position:l,orientation:h,label:new s.LabelGraphics({text:t.cn,pixelOffset:new y.a(0,-50),fillColor:new s.Color(.173,.659,.961,1),outlineColor:s.Color.WHITE,outlineWidth:3,style:w.a.FILL_AND_OUTLINE,verticalOrigin:S.a.BOTTOM})})}function I(){var e=N().aircraft;return Object(O.jsx)(O.Fragment,{children:Object.entries(e).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(O.jsx)(k,{data:a},n)}))})}var A=n(17);function T(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)("desc"),c=Object(l.a)(i,2),s=c[0],o=c[1],u=N().aircraft,d=Object(A.a)(Object.values(u));n&&d.sort((function(e,t){return e[n]<t[n]?"desc"===s?1:-1:e[n]>t[n]?"desc"===s?-1:1:0}));var h=function(e){n===e?o("desc"===s?"asc":"desc"):r(e)};return Object(O.jsx)("aside",{children:Object(O.jsxs)("table",{children:[Object(O.jsx)("thead",{children:Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{onClick:function(){return h("cn")},children:"CN"}),Object(O.jsx)("th",{onClick:function(){return h("speed")},children:"Speed"}),Object(O.jsx)("th",{onClick:function(){return h("altitude")},children:"Altitude"})]})}),Object(O.jsx)("tbody",{children:d.map((function(e){return Object(O.jsxs)("tr",{onAnimationEnd:function(e){return e.currentTarget.classList.remove("flash")},children:[Object(O.jsx)(F,{value:e.call}),Object(O.jsx)(F,{value:e.cn}),Object(O.jsx)(F,{value:e.speed}),Object(O.jsx)(F,{value:(e.altitude/3.281).toFixed(1)})]},"".concat(e.id,"-").concat(e.cn,"-").concat(e.type))}))})]})})}function F(e){var t=e.value,n=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current}(t)||0;return Object(O.jsx)("td",{style:{animationName:n>t?"redflash":"greenflash",animationFillMode:"forwards",animationDuration:"1s"},children:t})}n(26);var R=s.Cartesian3.fromDegrees(13.32477,58.312519,6089),L=function(){return Object(O.jsxs)("main",{style:{display:"flex",height:"100vh"},children:[Object(O.jsx)(T,{}),Object(O.jsxs)(o.d,{style:{flex:1},terrainProvider:Object(s.createWorldTerrain)(),extend:s.viewerCesiumInspectorMixin,shouldAnimate:!0,children:[Object(O.jsx)(o.b,{url:s.IonResource.fromAssetId(96188)}),Object(O.jsx)(o.a,{duration:0,destination:R}),Object(O.jsx)(I,{})]})]})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,28)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};c.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(C,{children:Object(O.jsx)(L,{})})}),document.getElementById("root")),E()}},[[27,1,2]]]);
//# sourceMappingURL=main.ba4d834a.chunk.js.map