(this["webpackJsonpvangso-mission-control"]=this["webpackJsonpvangso-mission-control"]||[]).push([[0],{0:function(e,t){e.exports=Cesium},21:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(8),c=n.n(i),s=(n(21),n(0)),o=n(5),l=n(3),u=n(9),d=n.n(u),h=n(10),f=n(6),j=n(4),b=function(e,t){var n=Object(j.a)({},e);return t.forEach((function(e){return delete n[e]})),n},v=n(11),O=n(12),m=n(13);function p(e){var t={call:"",receiver:"",id:"",source:0,symbol:0,lat:0,lon:0,altitude:0,heading:0,speed:0,climbrate:0,rotation:0,signal:0,errors:0,timestamp:0},n=e.match(/([^>]+)/);null!=n&&(t.call=n[1]);var r=e.match(/(?:,)([a-zA-Z0-9]+)(?::\/)/);null!=r&&(t.receiver=r[1]);var a=e.match(/(?: id)([a-fA-f0-9]+)/);null!=a&&(t.id=a[1]);var i=e.match(/(?:\/)(\d+)(?:h)/);null!=i&&(t.timestamp=m.DateTime.fromFormat(i[1],"HHmmss").toMillis());var c="0",s="0",o=e.match(/(?: !W)(\d)(\d)(?:!)/);null!=o&&(c=o[1],s=o[2]);var l=e.match(/(?:h)(\d+\.\d+)(?:[NS])/);null!=l&&(t.lat=g(l[1]+c)),function(e){var t=e.match(/(?::\/\d+[h]\d+[.]\d+)(.)/);if(null==t)return null;return"N"===t[1]}(e)||(t.lat*=-1);var u=e.match(/(?:[NS].)(\d+\.\d+)(?:[EW])/);null!=u&&(t.lon=g(u[1]+s)),function(e){var t=e.match(/(?::\/\d+[h]\d+[.]\d+[NS].\d+[.]\d+)(.)/);if(null==t)return null;return"E"===t[1]}(e)||(t.lon*=-1);var d=e.match(/(?:\/A=)(\d+)/);null!=d&&(t.altitude=parseInt(d[1])/3.281);var h=e.match(/(\d+)(?:\/)(\d+)(?:\/)/);null!=h&&(t.heading=parseInt(h[1]),t.speed=parseInt(h[2]));var f=e.match(/(?: )([+-]\d+)(?:fpm)/);null!=f&&(t.climbrate=parseInt(f[1]));var j=e.match(/(?: )([+-]\d+\.\d+)(?:rot)/);null!=j&&(t.rotation=parseFloat(j[1]));var b=e.match(/(?: )(\d+\.\d+)(?:dB)/);null!=b&&(t.signal=parseFloat(b[1]));var v=e.match(/(?: )(\d+)(?:e)/);return null!=v&&(t.errors=parseInt(v[1])),t.symbol=function(e){var t=parseInt(e.substr(0,2),16);return t=t>>2&15}(t.id),t.source=function(e){var t=parseInt(e.substr(0,2),16);return t&=3}(t.id),(isNaN(t.timestamp)||isNaN(t.lon)||isNaN(t.lat)||isNaN(t.altitude)||isNaN(t.heading)||isNaN(t.speed)||isNaN(t.climbrate)||isNaN(t.rotation))&&(console.log(t),console.log(e),console.log("-----------------------")),t}function g(e){var t=Math.floor(parseInt(e)/100);return t+(parseFloat(e)-100*t)/60}var C=function(){function e(t){Object(v.a)(this,e),this.onClose=void 0,this.onTrack=void 0,this.onReport=void 0,this.onCall=void 0,this.ws=void 0,this.options=void 0,this.listeners={},this.queryCalls=[],this.options=t}return Object(O.a)(e,[{key:"connect",value:function(){var e=this;return this.ws=new this.options.WebSocket("wss://glidertracker.de:8080/"),this.ws.onclose=function(){e.ws=null,e.onClose&&e.onClose()},this.ws.onmessage=function(t){e.handleMessage(t.data)},new Promise((function(t){e.ws.onopen=t}))}},{key:"send",value:function(e){this.ws&&this.ws.send(e)}},{key:"sendQueue",value:function(){var e=this;if(this.queryCalls.length>0){var t=this.queryCalls.shift();this.send(t),setTimeout((function(){e.sendQueue()}),333)}}},{key:"disconnect",value:function(){this.ws&&(this.ws.close(),this.ws=null)}},{key:"setView",value:function(e){var t=Object(l.a)(e,4),n=t[0],r=t[1],a=t[2],i=t[3];this.send("VIEW:".concat(n,"|").concat(r,"|").concat(a,"|").concat(i))}},{key:"getOverview",value:function(e){var t=Object(l.a)(e,4),n=t[0],r=t[1],a=t[2],i=t[3];this.send("OVERVIEW?0".concat(n,"|").concat(r,"|").concat(a,"|").concat(i))}},{key:"requestTrack",value:function(e,t,n){this.send("TRACK?".concat(e,"|").concat(Math.round(t/1e3),"|").concat(Math.round(n/1e3)))}},{key:"addListenerForId",value:function(e,t){var n=this;return this.listeners[e]=t,function(){delete n.listeners[e]}}},{key:"lookupGlider",value:function(e,t){this.send("CALL?"+e+"/"+t+"|")}},{key:"handleMessage",value:function(e){if(function(e){return-1!==e.search("TRACK:")}(e)&&this.onTrack){var t=e.split("|"),n=t.shift().slice(6),r=t.filter(Boolean).map((function(e){var t=e.split("/");return{lat:parseFloat(t[0]),lon:parseFloat(t[1]),alt:parseFloat(t[2]),time:Date.parse(t[3])}}));this.onTrack(n,r)}else if(function(e){return(-1!==e.search(">OGFLR,qAS")||-1!==e.search(">APRS,qAS")||-1!==e.search(">APRS,RELAY*")||-1!==e.search(">OGNFNT,qAS")||-1!==e.search(">OGNTRK,qAS"))&&-1!==e.search(" id")}(e)){var a=p(e);this.listeners[a.id]&&this.listeners[a.id](a),this.onReport&&this.onReport(a)}else if(function(e){return-1!==e.search("CALL:")}(e)){var i=function(e){var t={id:"",call:"",cn:"",type:""},n=e.match(/(?:CALL:)([^/]+)(?:\/)([^[]+)(?:\[)([^\]]*)(?:\])([^|]*)/);return null!=n&&(t.id=n[1],t.call=n[2],t.cn=n[3],t.type=n[4]),t}(e);this.onCall&&this.onCall(i)}else(function(e){return-1!==e.search("SEEN:")})(e)||function(e){return-1!==e.search("PING?!?")}(e)&&this.send("PONG!?!")}}]),e}(),k=n(2),x=new C({WebSocket:WebSocket}),y=Object(r.createContext)(void 0);function N(){x.connect().then((function(){x.setView([4.020996,55.646599,24.927979,61.41775]),console.log("Connection established.")}))}function I(e){var t=e.children,n=Object(r.useState)((function(){try{var e=localStorage.getItem("aircraft");return e?JSON.parse(e):{}}catch(t){return{}}})),a=Object(l.a)(n,2),i=a[0],c=a[1],s=Object(r.useState)(void 0),o=Object(l.a)(s,2),u=o[0],v=o[1],O=function(e,t){c(Object(j.a)(Object(j.a)({},i),{},Object(f.a)({},e,Object(j.a)(Object(j.a)({},i[e]),t))))};return x.onReport=function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i[t.id]?O(t.id,b(t,["call"])):(console.info("Missing data for aircraft with id:"+t.id+". Sending lookup!"),x.lookupGlider(t.id,t.call));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x.onCall=function(e){var t=e.id,n=e.call,r=e.cn,a=e.type;O(t,e),localStorage.setItem("aircraft",JSON.stringify(Object(j.a)(Object(j.a)({},JSON.parse(localStorage.getItem("aircraft")||"{}")),{},Object(f.a)({},t,{id:t,call:n,cn:r,type:a}))))},Object(k.jsx)(y.Provider,{value:{setAircraftWithId:O,aircraft:i,client:x,trackedAircraft:u,setTrackedAircraft:v},children:t})}function w(){return Object(r.useContext)(y)}N(),x.onClose=function(){console.log("Connection closed. Trying again!"),N()};var S=n(16),A=n(14),T=n(15);function M(e){var t=e.data,n=e.tracked,a=[t.lon,t.lat,t.altitude,t.heading,t.rotation],i=a[0],c=a[1],u=a[2],d=a[3],h=a[4],f=Object(r.useState)(0),j=Object(l.a)(f,2),b=j[0],v=j[1],O=Object(o.e)().viewer;if(Object(r.useEffect)((function(){O&&i&&c&&Object(s.sampleTerrainMostDetailed)(O.terrainProvider,[s.Cartographic.fromDegrees(i,c,0)]).then((function(e){return v(e[0].height)}))}),[u]),"number"!==typeof i)return null;var m=Math.max(b,u),p=s.Cartesian3.fromDegrees(i,c,m),g=s.Math.toRadians(d-90),C=h/6,x=new s.HeadingPitchRoll(g,0,C),y=new s.ConstantProperty(s.Transforms.headingPitchRollQuaternion(s.Cartesian3.fromDegrees(i,c,u),x));return Object(k.jsx)(o.c,{model:{uri:"assets/arcus.glb",scale:1,maximumScale:110,minimumPixelSize:300},position:p,orientation:y,label:new s.LabelGraphics({text:t.cn,pixelOffset:new S.a(0,-50),fillColor:new s.Color(.173,.659,.961,1),outlineColor:s.Color.WHITE,outlineWidth:3,style:A.a.FILL_AND_OUTLINE,verticalOrigin:T.a.BOTTOM}),tracked:n})}function R(){var e=w(),t=e.aircraft,n=e.trackedAircraft;return Object(k.jsx)(k.Fragment,{children:Object.entries(t).map((function(e){var t=Object(l.a)(e,2),r=t[0],a=t[1];return Object(k.jsx)(M,{data:a,tracked:n===a.id},r)}))})}function L(){var e=Object(r.useState)(null),t=Object(l.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)("desc"),c=Object(l.a)(i,2),s=c[0],o=c[1],u=w(),d=u.aircraft,h=u.setTrackedAircraft,f=u.trackedAircraft,j=Object.values(d).filter((function(e){return e.altitude}));n&&j.sort((function(e,t){return e[n]<t[n]?"desc"===s?1:-1:e[n]>t[n]?"desc"===s?-1:1:0}));var b=function(e){n===e?o("desc"===s?"asc":"desc"):a(e)};return Object(k.jsx)("aside",{style:{padding:"10px"},children:Object(k.jsxs)("table",{className:"overview-table",style:{textAlign:"left"},children:[Object(k.jsx)("thead",{children:Object(k.jsxs)("tr",{children:[Object(k.jsx)("th",{onClick:function(){return b("call")},children:"Callsign"}),Object(k.jsx)("th",{onClick:function(){return b("cn")},children:"CN"}),Object(k.jsx)("th",{onClick:function(){return b("speed")},children:"Speed"}),Object(k.jsx)("th",{onClick:function(){return b("climbrate")},children:"vs"}),Object(k.jsx)("th",{onClick:function(){return b("altitude")},children:"Altitude"})]})}),Object(k.jsx)("tbody",{children:j.map((function(e){return Object(k.jsxs)("tr",{onAnimationEnd:function(e){return e.currentTarget.classList.remove("flash")},onClick:function(){return h(e.id)},style:f===e.id?{background:"rgba(0, 162, 255, 0.4)"}:void 0,children:[Object(k.jsx)(F,{value:e.call}),Object(k.jsx)(F,{value:e.cn}),Object(k.jsx)(F,{value:Math.round(1.852*e.speed)}),Object(k.jsx)(F,{value:(e.climbrate/60).toFixed(1)}),Object(k.jsx)(F,{value:e.altitude})]},"".concat(e.id,"-").concat(e.cn,"-").concat(e.type))}))})]})})}function F(e){var t=e.value,n=function(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e})),t.current}(t)||0;return Object(k.jsx)("td",{style:{animationName:n>t?"redflash":"greenflash",animationFillMode:"forwards",animationDuration:"1s"},children:t})}n(26);var E=s.Cartesian3.fromDegrees(13.32477,58.312519,6089),P=function(){return Object(k.jsxs)("main",{style:{display:"flex",height:"100vh"},children:[Object(k.jsx)(L,{}),Object(k.jsxs)(o.d,{style:{flex:1},terrainProvider:Object(s.createWorldTerrain)(),extend:s.viewerCesiumInspectorMixin,animation:!1,timeline:!1,children:[Object(k.jsx)(o.b,{url:s.IonResource.fromAssetId(96188)}),Object(k.jsx)(o.a,{duration:0,destination:E}),Object(k.jsx)(R,{})]})]})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,28)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))};s.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwNzQ4ODIyNC1lMWRkLTQyNjktOTQwMS1hY2MzYjliMDRmNDUiLCJpZCI6NTIwMzgsImlhdCI6MTYxODQwNTAyNH0.kgVLR6n3y6l6BR4hzGbAka5tElPjyXiDWMC2IwPqbIk",c.a.render(Object(k.jsx)(a.a.StrictMode,{children:Object(k.jsx)(I,{children:Object(k.jsx)(P,{})})}),document.getElementById("root")),D()}},[[27,1,2]]]);
//# sourceMappingURL=main.d392a7e7.chunk.js.map